<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kalkul√°tor vah</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&family=DM+Sans:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #f5f4f0;
    --surface: #ffffff;
    --border: #e0ddd6;
    --text: #1a1a18;
    --muted: #888880;
    --accent: #2d5a27;
    --accent-light: #e8f0e6;
    --danger: #c0392b;
    --mono: 'DM Mono', monospace;
    --sans: 'DM Sans', sans-serif;
  }

  body {
    font-family: var(--sans);
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    padding: 2rem 1rem;
  }

  header {
    max-width: 720px;
    margin: 0 auto 2rem;
    border-bottom: 2px solid var(--text);
    padding-bottom: 1rem;
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 1rem;
  }

  header h1 { font-size: 1.6rem; font-weight: 600; letter-spacing: -0.02em; }
  header p { color: var(--muted); font-size: 0.9rem; margin-top: 0.3rem; }

  .sync-status {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    font-size: 0.78rem;
    color: var(--muted);
    white-space: nowrap;
    margin-top: 0.3rem;
  }

  .sync-dot {
    width: 8px; height: 8px;
    border-radius: 50%;
    background: #ccc;
    flex-shrink: 0;
    transition: background 0.3s;
  }

  .sync-dot.syncing { background: #f0a500; }
  .sync-dot.synced  { background: #2d5a27; }
  .sync-dot.error   { background: var(--danger); }

  .container { max-width: 720px; margin: 0 auto; }

  .nav-box {
    background: var(--surface);
    border: 1.5px solid var(--border);
    border-radius: 10px;
    padding: 1rem 1.2rem;
    margin-bottom: 2rem;
  }

  .nav-box h3 {
    font-size: 0.78rem;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: var(--muted);
    margin-bottom: 0.7rem;
  }

  .nav-list { display: flex; flex-wrap: wrap; gap: 0.5rem; list-style: none; }

  .nav-list li a {
    display: inline-block;
    padding: 0.35rem 0.8rem;
    background: var(--accent-light);
    color: var(--accent);
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
    text-decoration: none;
    border: 1.5px solid transparent;
    transition: border-color 0.15s, background 0.15s;
  }

  .nav-list li a:hover { border-color: var(--accent); background: #d4e8d0; }
  .nav-empty { font-size: 0.85rem; color: var(--muted); font-style: italic; }

  .add-form { display: flex; gap: 0.6rem; margin-bottom: 2rem; }

  .add-form input[type="text"] {
    flex: 1;
    padding: 0.7rem 1rem;
    border: 1.5px solid var(--border);
    border-radius: 6px;
    font-family: var(--sans);
    font-size: 0.95rem;
    background: var(--surface);
    outline: none;
    transition: border-color 0.15s;
  }

  .add-form input[type="text"]:focus { border-color: var(--accent); }

  .btn {
    padding: 0.7rem 1.3rem;
    border: none;
    border-radius: 6px;
    font-family: var(--sans);
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: opacity 0.15s, transform 0.1s;
  }

  .btn:active { transform: scale(0.97); }
  .btn-primary { background: var(--accent); color: #fff; }
  .btn-primary:hover { opacity: 0.88; }

  .btn-back {
    background: none;
    color: var(--accent);
    border: 1.5px solid var(--accent);
    padding: 0.4rem 0.8rem;
    font-size: 0.8rem;
    text-decoration: none;
  }

  .btn-back:hover { background: var(--accent-light); }

  .btn-danger {
    background: none;
    color: var(--danger);
    border: 1.5px solid var(--danger);
    padding: 0.4rem 0.8rem;
    font-size: 0.8rem;
  }

  .btn-danger:hover { background: #fdf0ef; }

  .exercises { display: flex; flex-direction: column; gap: 1.2rem; }

  .card {
    background: var(--surface);
    border: 1.5px solid var(--border);
    border-radius: 10px;
    overflow: hidden;
    animation: slideIn 0.2s ease;
    scroll-margin-top: 1rem;
  }

  @keyframes slideIn {
    from { opacity: 0; transform: translateY(-8px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  .card-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem 1.2rem;
    border-bottom: 1px solid var(--border);
    background: var(--accent-light);
  }

  .card-header h2 { font-size: 1rem; font-weight: 600; }
  .card-header .header-right { display: flex; align-items: center; gap: 0.8rem; }

  .rm-input-wrap { display: flex; align-items: center; gap: 0.5rem; }
  .rm-input-wrap label { font-size: 0.8rem; color: var(--muted); white-space: nowrap; }

  .rm-input-wrap input[type="number"] {
    width: 80px;
    padding: 0.35rem 0.6rem;
    border: 1.5px solid var(--border);
    border-radius: 5px;
    font-family: var(--mono);
    font-size: 0.9rem;
    text-align: right;
    background: var(--surface);
    outline: none;
    transition: border-color 0.15s;
  }

  .rm-input-wrap input[type="number"]:focus { border-color: var(--accent); }
  .rm-input-wrap span { font-size: 0.8rem; color: var(--muted); }

  .table-wrap { overflow-x: auto; }
  table { width: 100%; border-collapse: collapse; }

  thead th {
    font-family: var(--mono);
    font-size: 0.75rem;
    color: var(--muted);
    text-align: right;
    padding: 0.6rem 1rem;
    border-bottom: 1px solid var(--border);
    font-weight: 500;
    letter-spacing: 0.03em;
    text-transform: uppercase;
  }

  thead th:first-child { text-align: left; }
  tbody tr { transition: background 0.1s; }
  tbody tr:hover { background: #fafaf8; }

  tbody td {
    padding: 0.55rem 1rem;
    font-family: var(--mono);
    font-size: 0.9rem;
    text-align: right;
    border-bottom: 1px solid #f0ede8;
  }

  tbody td:first-child { text-align: left; font-weight: 500; color: var(--accent); }
  tbody tr:last-child td { border-bottom: none; }

  .highlight-row { background: var(--accent-light) !important; }
  .highlight-row td { font-weight: 600; }

  .empty-state {
    text-align: center;
    padding: 3rem 1rem;
    color: var(--muted);
    font-size: 0.95rem;
    border: 2px dashed var(--border);
    border-radius: 10px;
  }

  .empty-state span { display: block; font-size: 2rem; margin-bottom: 0.5rem; }
  .loading { text-align: center; padding: 3rem 1rem; color: var(--muted); font-size: 0.95rem; }
</style>
</head>
<body>

<header>
  <div>
    <h1>Kalkul√°tor vah ‚Äî % z maxima</h1>
    <p>Zadej sv≈Øj 1RM a zobraz v√°hy od 40 % do 100 % s krokem 5 %.</p>
  </div>
  <div>
    <div class="sync-status">
      <div class="sync-dot" id="syncDot"></div>
      <span id="syncLabel">P≈ôipojov√°n√≠‚Ä¶</span>
    </div>
  </div>
</header>

<div class="container">

  <div class="nav-box" id="navBox">
    <h3>P≈ôej√≠t na cvik</h3>
    <ul class="nav-list" id="navList">
      <li><span class="nav-empty">Zat√≠m ≈æ√°dn√© cviky‚Ä¶</span></li>
    </ul>
  </div>

  <div class="add-form">
    <input type="text" id="exerciseInput" placeholder="N√°zev cviku (nap≈ô. Bench press)" maxlength="50">
    <button class="btn btn-primary" onclick="addExercise()">Ôºã P≈ôidat cvik</button>
  </div>

  <div class="exercises" id="exercises">
    <div class="loading" id="loadingState">‚è≥ Naƒç√≠t√°m data‚Ä¶</div>
    <div class="empty-state" id="emptyState" style="display:none">
      <span>üèãÔ∏è</span>
      Zat√≠m nem√°≈° ≈æ√°dn√Ω cvik. P≈ôidej prvn√≠ v√Ω≈°e.
    </div>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDd1SiUumGM9QQaT6CTgAKCpUs78EO0cFk",
    databaseURL: "https://moje-aplikace-1bf1d-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "moje-aplikace-1bf1d",
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const cvikyRef = ref(db, 'cviky');

  let exercises = [];
  let saveTimer = null;

  const syncDot = document.getElementById('syncDot');
  const syncLabel = document.getElementById('syncLabel');

  function setStatus(state) {
    syncDot.className = 'sync-dot ' + state;
    if (state === 'syncing') syncLabel.textContent = 'Ukl√°d√°m‚Ä¶';
    if (state === 'synced')  syncLabel.textContent = 'Synchronizov√°no ‚úì';
    if (state === 'error')   syncLabel.textContent = 'Chyba p≈ôipojen√≠';
  }

  let isSaving = false;

  onValue(cvikyRef, (snapshot) => {
    setStatus('synced');
    // Pokud pr√°vƒõ ukl√°d√°me, nep≈ôekreslujeme ‚Äî p≈ôedejdeme vyskoƒçen√≠ kurzoru
    if (isSaving) return;
    exercises = snapshot.val() || [];
    renderAll();
  }, () => setStatus('error'));

  function save() {
    setStatus('syncing');
    isSaving = true;
    clearTimeout(saveTimer);
    saveTimer = setTimeout(() => {
      set(cvikyRef, exercises)
        .then(() => {
          setStatus('synced');
          // Po ulo≈æen√≠ poƒçk√°me chv√≠li a pak opƒõt naslouch√°me zmƒõn√°m
          setTimeout(() => { isSaving = false; }, 1000);
        })
        .catch(() => { setStatus('error'); isSaving = false; });
    }, 800);
  }

  const input = document.getElementById('exerciseInput');
  input.addEventListener('keydown', e => { if (e.key === 'Enter') addExercise(); });

  window.addExercise = function() {
    const name = input.value.trim();
    if (!name) return;
    exercises.push({ name, rm: '' });
    input.value = '';
    save();
    renderAll();
  }

  window.removeExercise = function(i) {
    showConfirm(`Opravdu chce≈° odebrat cvik ‚Äû${exercises[i].name}"?`, () => {
      exercises.splice(i, 1);
      save();
      renderAll();
    });
  }

  function showConfirm(message, onYes) {
    const overlay = document.createElement('div');
    overlay.style.cssText = `
      position: fixed; inset: 0; background: rgba(0,0,0,0.4);
      display: flex; align-items: center; justify-content: center;
      z-index: 1000;
    `;
    overlay.innerHTML = `
      <div style="background:#fff; border-radius:12px; padding:1.5rem 1.8rem;
                  max-width:340px; width:90%; box-shadow:0 8px 32px rgba(0,0,0,0.18);">
        <p style="font-family:'DM Sans',sans-serif; font-size:0.95rem;
                  color:#1a1a18; margin-bottom:1.3rem; line-height:1.5;">${message}</p>
        <div style="display:flex; gap:0.6rem; justify-content:flex-end;">
          <button id="confirmNo" style="padding:0.6rem 1.2rem; border-radius:6px;
            border:1.5px solid #e0ddd6; background:none; font-family:'DM Sans',sans-serif;
            font-size:0.9rem; font-weight:600; cursor:pointer; color:#1a1a18;">Ne</button>
          <button id="confirmYes" style="padding:0.6rem 1.2rem; border-radius:6px;
            border:none; background:#c0392b; color:#fff; font-family:'DM Sans',sans-serif;
            font-size:0.9rem; font-weight:600; cursor:pointer;">Ano</button>
        </div>
      </div>
    `;
    document.body.appendChild(overlay);
    overlay.querySelector('#confirmYes').onclick = () => { overlay.remove(); onYes(); };
    overlay.querySelector('#confirmNo').onclick  = () => overlay.remove();
    overlay.addEventListener('click', e => { if (e.target === overlay) overlay.remove(); });
  }

  window.updateRM = function(i, val) {
    exercises[i].rm = val;
    save();
    const cards = document.querySelectorAll('.card');
    const tableWrap = cards[i].querySelector('.table-wrap');
    tableWrap.innerHTML = '';
    tableWrap.appendChild(buildTable(val));
  }

  function slugify(name) {
    return 'cvik-' + name.toLowerCase().replace(/\s+/g, '-').replace(/[^\w-]/g, '') || 'cvik';
  }

  function renderNav() {
    const navList = document.getElementById('navList');
    if (exercises.length === 0) {
      navList.innerHTML = '<li><span class="nav-empty">Zat√≠m ≈æ√°dn√© cviky‚Ä¶</span></li>';
      return;
    }
    const sorted = exercises
      .map((ex, i) => ({ ex, i }))
      .sort((a, b) => a.ex.name.localeCompare(b.ex.name, 'cs'));
    navList.innerHTML = sorted.map(({ ex, i }) =>
      `<li><a href="#${slugify(ex.name)}-${i}">${escHtml(ex.name)}</a></li>`
    ).join('');
  }

  function renderAll() {
    const container = document.getElementById('exercises');
    const empty = document.getElementById('emptyState');
    const loading = document.getElementById('loadingState');

    loading.style.display = 'none';
    [...container.children].forEach(c => {
      if (c !== empty && c !== loading) c.remove();
    });

    renderNav();

    if (exercises.length === 0) { empty.style.display = ''; return; }
    empty.style.display = 'none';

    exercises.forEach((ex, i) => container.appendChild(buildCard(ex, i)));
  }

  function buildCard(ex, i) {
    const card = document.createElement('div');
    card.className = 'card';
    card.id = slugify(ex.name) + '-' + i;

    const header = document.createElement('div');
    header.className = 'card-header';
    header.innerHTML = `
      <h2>${escHtml(ex.name)}</h2>
      <div class="header-right">
        <div class="rm-input-wrap">
          <label>1RM</label>
          <input type="number" min="0" step="0.5" placeholder="0" value="${ex.rm}" oninput="updateRM(${i}, this.value)">
          <span>kg</span>
        </div>
        <a href="#navBox" class="btn btn-back">‚Üë Seznam</a>
        <button class="btn btn-danger" onclick="removeExercise(${i})">Odebrat</button>
      </div>
    `;

    const tableWrap = document.createElement('div');
    tableWrap.className = 'table-wrap';
    tableWrap.appendChild(buildTable(ex.rm));

    card.appendChild(header);
    card.appendChild(tableWrap);
    return card;
  }

  function buildTable(rm) {
    const table = document.createElement('table');
    const rmVal = parseFloat(rm) || 0;

    table.innerHTML = `
      <thead><tr>
        <th>%</th><th>V√°ha (kg)</th><th>Zaokrouhleno (2,5 kg)</th>
      </tr></thead>
    `;

    const tbody = document.createElement('tbody');
    for (let pct = 100; pct >= 40; pct -= 5) {
      const exact = rmVal > 0 ? (rmVal * pct / 100).toFixed(1) : '‚Äî';
      const rounded = rmVal > 0 ? (Math.round((rmVal * pct / 100) / 2.5) * 2.5).toFixed(1) : '‚Äî';
      const tr = document.createElement('tr');
      if (pct === 100) tr.classList.add('highlight-row');
      tr.innerHTML = `<td>${pct} %</td><td>${exact}</td><td>${rounded}</td>`;
      tbody.appendChild(tr);
    }
    table.appendChild(tbody);
    return table;
  }

  function escHtml(s) {
    return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  }
</script>
</body>
</html>
